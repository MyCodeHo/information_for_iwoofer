

# 分析开发需求

## Xover功能

### 一、整体交互要点

- 选中某个滤波器曲线：
  - 双击该曲线，或长按 > 1 秒。
- 水平滑动：改频率（LPF/HPF 的截止频率，或 PEQ 的中心频率）。
- 垂直滑动：
  - 在 PEQ 上：改增益 dB（往上抬是增益↑，往下是衰减↓）。
  - 在 LPF/HPF 上：改滤波“阶数/斜率”（12/18/24/36/48 dB/Oct 等）。
- 双指捏合（放大/缩小）：只对 PEQ 生效，用来调 Q（带宽）。这是你问“Q:1.41 怎么调”的手势。

### 二、PEQ Off 页面里“HP:24 db/oct; Freq:42Hz”是什么意思？图上如何体现？

- 含义
  - HP = High‑Pass 高通/次声滤波，用来切掉过低频率，保护单元。
  - 24 dB/Oct = 每下降一个八度（频率减半）电平降低 24 dB（4 阶）。斜率越大，滚降越快。
  - Freq: 42 Hz = 这只高通的“转折/设定频率”。在这个点附近开始按设定斜率快速衰减到更低频段。
- 图上的体现（参看你第2张图的红色左侧曲线）
  - 红色部分是 HPF 的幅频响应：从 42 Hz 往左（更低频）呈陡降趋势。
  - “24 dB/Oct”的可视化：在对数坐标里，从 42 Hz 再往左到 21 Hz（正好半频率=一倍频程）大约会再低 24 dB。
  - 中间接近 0 dB 的平台是“通带”（被保留下来的频段）。HPF 负责左边的低频滚降；右边蓝色部分是 LPF 的高频滚降。两者叠加成你看到的“带通”形状。
- 怎么改这两个数
  - 先选中红色 HP 曲线（双击或长按 >1s）。
  - 水平拖动：改变 Freq（42 Hz 会随你的左右移动而变）。
  - 垂直拖动：改变阶数/斜率（在 12/18/24/36/48 dB/Oct 等档位间跳）。

实用建议

- 密封箱：HPF 多设 15–25 Hz（24 dB/Oct 起步）。
- 倒相箱：HPF 设在箱体调谐频率 Fb 附近（略高或略低都有人用，常见 24 dB/Oct），防止 Fb 以下超行程。
- 若你的系统前端（如 AVR）已经做了分频，避免在 iWoofer 再做同频点的 LPF/HPF 以免“双重分频”。

### 三、PEQ On 页面里“PEQ1:83Hz Q:1.41 dB:0.2”是什么意思？

- 含义
  - PEQ1：第 1 段参数均衡（Parametric EQ，第1个滤波点）。
  - 83 Hz：该段的“中心频率”（红色虚线对准的频率）。
  - Q: 1.41：该段的“品质因数”，决定带宽。Q 越大带越窄，Q 越小带越宽。Q≈1.4 的宽度大约在“约 1 个八度左右”的量级（经验值，具体换算与实现有关）。
  - dB: 0.2：增益，仅+0.2 dB，是非常轻微的提升，所以你看到的蓝色“鼓包”很浅。
- 图上的体现（参看你第3张图）
  - 红色虚线：标注当前选中的 PEQ 的中心频率（83 Hz）。
  - 蓝色曲线：包含了 Xover（HPF/LPF）与已启用的 PEQ 叠加后的总体响应；在 83 Hz 附近会有一个很浅的“小隆起”（+0.2 dB）。
  - 若把 dB 拉大一些（比如 +3 dB），你会清楚看到在 83 Hz 中心处形成一个“钟形（bell）”峰；把 dB 设负值（比如 −3 dB）则是“挖坑”。

### 四、如何“调整 Q:1.41”

- 选中该段 PEQ（双击或长按曲线靠近 83 Hz 的位置，标题会显示“PEQ1:…”表示选中）。
- 用双指在图上“捏合/张开”：
  - 捏紧（双指靠拢）：Q 变大（带变窄，钟形更瘦）。
  - 张开（双指分开）：Q 变小（带变宽，钟形更肥）。
- 同时配合：
  - 水平单指拖动：改中心频率（83 Hz 左右移动）。
  - 垂直单指拖动：改增益 dB（向上更大提升，向下变为削减）。

### 五、常用的调参顺序

1. 先把 HPF/LPF（PEQ Off 页面）定住：
   - 设好 HPF 来保护单元（密封 20 Hz/24 dB 起步；倒相 ≈Fb/24 dB）。
   - 设好 LPF 的分频点与斜率，与主箱衔接（常用 LR24，70–90 Hz 起步）。
2. 再到 PEQ On：
   - 对准房间峰值：在峰值频点上，选中一个 PEQ 段，水平拖到该频点；垂直向下拖到合适负增益；用双指捏合调 Q 只削那一带，不影响两侧过多。
   - 对准凹陷：一般少用大幅提升，先检查相位/摆位/分频；必要时小幅 +dB 并加窄 Q 避免牵连太宽频段。
3. 每改一个大项就“保存预设”，便于 A/B 对比与回退。

### 六、常见疑问与排错

- “我垂直拖动为什么不是改 dB 而是变成 12/24/36 dB/Oct？”
  因为你选中的是 HPF/LPF 曲线；只有选中 PEQ 才是改增益 dB。
- “为什么看不出 0.2 dB 的变化？”
  0.2 dB 很小，在图上几乎看不出来，建议先调到 ±3 dB 观察形状，再回到需要的幅度。
- “Q 调了但数值变化不大？”
  先把增益拉到 ±3～6 dB，形状更明显，再细调 Q；确认是双指捏合这个手势。

## Room Correction功能

### 通用准备

- 在 Xover 里先把 HPF/LPF、相位/延时定好，避免校正期间分频在变化。
- 测量前关掉会改频响的前端处理（AVR 的房间校正、Loudness、Dynamic EQ 等）。
- 环境尽量安静，把音量调到提示区间；手机麦克风不要遮挡；如用外置麦，请先在 Settings 做校准/选择。

### 基本思路

先用Wizard测出近场声波曲线，然后在耳边用Response & Compensation功能。

### 一、Wizard（向导式自动校正）

- 用“分步引导”的方式完成测量与自动补偿（会重置已有 PEQ/FIR），最后把补偿结果写入设备。与页面的手动设置部分无关，相当于有三个调整渠道，分别是Xover，Wizard，界面手动调整，三者存储在不同的地方，在起作用的时候会进行叠加的，预设存储时会存储所有的设置。

界面要点

- 顶部右侧：Restart（重测）、Clear（清空测量/补偿）、Xover（跳转到分频页）。
- 弹窗提示要点：打开低音炮、不要太贴墙、后面板的模拟音量旋钮开到“响但不过载”、把手机尽量靠近低音炮，且与振盆和倒相孔保持等距；“All PEQ/FIR settings will be reset”（应用向导前会清空已有滤波）。

操作步骤

1. Next 开始：按提示把手机靠近低音炮（近场测量，信噪比更高）。

2. 按屏幕提示播放测试信号（向导会配合 Settings 里的 Auto Level 将采样电平调到目标值）。

3. 完成扫频后，向导生成“补偿建议”（结束后的三个选项）。如允许，会直接写入设备。

   Near Field：接近低音炮近场的本体响应；

   Linear：尽量平直的目标；

   Boomy Region：优先抑制40–80 Hz等“发胀”频段、听感更耐听的目标。

4. 如果结果不理想：点 Restart 重新测；或先 Clear 再重来；也可先去 Settings 调整限制（最大提升/衰减、Q 范围、步进延时等）后再测。

理解与建议

- 近场测量主要用来拿到“设备自身的基线响应”，降低房间反射/噪声的影响，让自动算法更稳。
- 如果你打算做多点（围绕主听位 3–6 点）来追求更“耐听”的平均值，这通常在 Wizard 的后续步骤或 Response 页面完成（见下一节）。

### 二、Response & Compensation（响应与补偿）

- 查看测量得到的频响（Response），一键生成补偿（Compensate），并预览/编辑补偿后曲线，再写入设备。

界面要点

- 按钮含义：

  - Compensate：根据当前响应与目标曲线，自动生成补偿滤波（优先削峰、谨慎补坑）。
  - Resp：发送声音并得到音频曲线。
  - Stop：清空已测/已算的曲线或补偿。
  - Xover：跳到分频页做衔接微调。

- 曲线阅读：横轴频率（20–500 Hz），纵轴为相对电平（dB）。

  绿线：当前或最近一次“近场/听位测量”的原始响应（未经补偿的实时/原始轨迹），抖动较多、细节明显。

  蓝线：对绿线做平滑/平均后的“用于计算补偿的响应”。补偿（Compensate）是基于这条线与目标曲线的差值来生成的。

  紫色虚线（右侧纵轴是百分比）：THD（总谐波失真）随频率的估计。越高说明该频段测量更容易失真。

  棕色线：环境噪声/底噪或输入电平包络的参考轨迹（版本不同表现略有差异），有助于判断信噪比是否足够。

怎么用

1. 先测出 Response，一般为贴近音响的地方（通过 Wizard 或在此页点击Resp完成测量）。
2. 长按某一个曲线，设置为灰色虚线，为参考曲线，参考曲线可以上下滑动来改变顺滑程度。
3. 再点击Resp测一下近身点位，得到近身的音频曲线。
4. 点击Compensate，会自动计算参数应用到设备（通常会自动写入 PEQ 槽位），如果想要再次测量，可以clean清楚再走一次完整流程，不然会卡死可以保存为一个预设。
5. （可选）再次点击Resp得到一个近身音频曲线，可以感觉到调整的效果。

建议与注意

- 建议只在低频段（例如 20–120 Hz）做补偿；更高频段交给主箱/其他系统。
- 先削峰，再考虑适度补谷；深而窄的谷常由相位抵消造成，不宜大幅拉升。
- 分频点附近以较窄 Q、小幅度处理为主，避免破坏主箱与超低的衔接。

### 三、Spl Meter（声压与频谱/失真监视）

- 提供实时的频谱/电平监视与失真（THD）估计，辅助设定音量、查找共振/杂音、对比不同设置下的噪声底与谐波。

界面要点

- 标题栏显示当前主峰情况：示例为“45hz -63.2db THD=26.6%”（当前 45 Hz 处电平 -63.2 dB、估算总谐波失真 26.6%）。
- 右上角：WNoise Off/On（内置白噪声开关，用于激励）、Xover 快捷入口。
- 曲线：实时光谱轨迹（示例红/蓝两条用于对照，它当作“蓝色即时 vs 红色平滑平均”的可视化对比即可使用）。

怎么用

- 设电平：打开 WNoise，把主音量调到测量所需的响度（避免过载），看整体噪声底与峰值。
- 查问题：播放 30–80 Hz 的正弦或扫频，观察 THD 和谱线；异常高的 THD、特定频段尖峰，常对应单元超行程、箱体/房间共振或漏风/拍边。
- 验证：改完 Xover 或补偿后，回 Spl Meter 看红线是否朝预期移动。

注意

- 手机麦的极低频与 THD 估计仅作相对参考；追求绝对精度需外置校准麦。
- 避免以 THD 单一指标“抹平一切”，最终以听感与综合曲线为准。

### 四、Settings（测量与补偿设置）

- 设定 Wizard/Response/测量流程的策略、限幅与时序，确保测得稳定、补偿安全。

可见选项解释

- Auto Level（自动电平）
  - Enabled：开启后，系统会把测试信号与采集电平自动调到“Target”附近，避免过载/过低。
  - Target：目标录音电平（示例 -16 dBFS）。经验值：-12 ~ -18 dBFS 区间较稳。
- Auto Range Recognition（自动有效频段识别）
  - Enabled：根据信噪比/响应稳定性，自动判定“可信的测量范围”，避免把无效/极低 SNR 的数据纳入计算。
  - Optimism：相当于“激进程度”。数值越高越“乐观”，会接受更边缘的频段作为有效范围；数值低则更保守。建议中等（例如 8–12）起步。
- Frequency Step Delay（频点步进延时）
  - Delay：在逐点扫频时，每个频点停留的时间（示例 1000 ms）。房间混响时间较长或端口/箱体低频响应“起动慢”时，适当加大（800–1200 ms）；想加快流程可适度降低，但稳定性会差一些。

- Max Boost of Compensation：最大提升（建议 +3 ~ +6 dB）。

  

一套可直接照做的“起始模板”

- Xover：LPF 80 Hz（LR24），HPF 20 Hz（密封，LR24）或 Fb±2 Hz（倒相，24 dB/Oct），极性/延时先对齐到“分频处能量最大且平顺”。
- Settings：Auto Level 开；Target −16 dB；Auto Range 开；Optimism 10；Step Delay 1000 ms；Max Boost +4 dB；Max Cut −9 dB；Q 0.7–6；校正频段 20–120 Hz。
- 流程：
  1. Wizard：按提示近场测一遍并应用补偿（或只生成不应用，先看效果）。
  2. Response & Compensation：查看“前/后”，必要时对个别 PEQ 做微调（双击选中，横移改频点，竖移改增益，捏合改 Q）。
  3. Spl Meter：用白噪声或扫频复核电平与失真，检查是否有新引入的共振/拍边；必要时回到 Xover 或补偿里做小改。
  4. 保存为预设（影院/音乐可各存一套），最后再做一次复测确认。

易踩的坑与规避

- 双重分频/双重校正：AVR 已设 80 Hz 且有自带校正时，请在 iWoofer 侧避免再做相同频段的 LPF/校正；否则曲线会叠加出意外峰谷。
- 大幅“填坑”：深而窄的谷用 EQ 很难补好，容易耗光余量并带来失真；优先通过摆位、相位/延时修正，再小幅补。
- 未预留 Headroom：允许正向提升时，建议先整体把低音炮输出衰减 3–6 dB，再让系统生成补偿，避免顶到限幅。
- 频点停留太短：低频/端口需要时间建立稳态，Step Delay 太短会导致读数不稳、补偿失准。

## 主页面

### 一、Gain Control

- 功能
  - 数字主增益，控制低音炮通道整体电平（进入分频/滤波/校正之前或之后，取决于设备内部路由，但本质是子通道总音量）。
- 怎么用
  - 用 Spl Meter/校准噪声把测量电平调到安全区；影院标定可按 75 dB（或 85 dB）参考流程，音乐则以“不过载且余量足”为准。
- 建议
  - 做 Room Correction 前先把 Gain 降 3–6 dB，给可能的“正向提升”留出 headroom。

### 二、SHS Control（Sub‑Harmonic Synthesizer，次谐波合成/低频增强）

- 功能
  - 从较高频率内容“合成”次谐波，主观上让超低频更厚（类似一些功放的“超低增强/合成低频”）。
- 怎么用
  - 滑块 0–100% 为混合量。数值越大，合成成分越多。
- 建议与注意
  - 纯测量/校正阶段请设为 0%，否则会干扰真实频响，增加 THD。
  - 日常听感可微量使用：5–15% 起步，配合略高一些的 HPF（把次声保护提高 2–5 Hz），避免端口风噪或单元超行程。
  - 过多会带来“虚胖/拖尾”和失真。

### 三、Delay Control（时延）

- 功能
  - 为低音炮通道加入延时，用于和主箱做时间对齐/声像对齐，尤其在分频点附近（如 70–90 Hz）使合成更平坦。
- 怎么用
  - 以听位为准，在 Spl Meter 用窄带正弦（或 R&C 页面看分频处）边调边看，让分频频点附近的合成能量最大且曲线最平顺。
  - 距离换算：1 ms ≈ 34.3 cm 声程。若低音炮比主箱“近”约 70 cm，可先加 ≈2 ms 延时再微调。
- 建议
  - 优先用 Delay 做“粗对齐”，再用 Phase 控制做细修。
  - 如果需要“负延时”（低音炮比主箱远），只能给主箱通道加延时或物理移动；子通道本身不能“提前”。

### 四、Phase Control（相位控制，连续相位/全通滤波 APF）

- 功能
  - 通过全通滤波（All‑Pass）在某一“枢轴频率”附近旋转相位，用来精修分频点的耦合。你界面里显示“Phase 10Hz”，表示当前相位旋转的中心/工作频率是 10 Hz。
- 怎么用（实操）
  - 把 Phase 的频率调到“接近你的 LPF 分频点”（例如 LPF=80 Hz，先把 Phase 调到 80 Hz 左右），再缓慢滑动寻找“分频处响应最平顺、合成能量最大的点”。
  - 配合 Delay 小幅来回：先 Delay 找大体峰值，再用 Phase 精修到最顺。
- 建议
  - 分频点越高，相位枢轴频率也应靠近该点；不要长期放在 10 Hz 这类远离分频的频率，否则对分频带帮助有限。
  - 如有“极性反相”按钮，先确保极性选择正确，再做连续相位的细调。

### 五、Limiter Compressor Control（限幅/压缩器）

- 功能保护与控制：限制超大低频瞬态，避免功放削顶、单元超行程或“碰碰声”。也可适度压缩，让电影大动态更可控。
- 怎么用
  - Attack time（起动速度，dB/s）
    - 表示“每秒最多能够衰减多少分贝”。数值越大=动作越快。
    - 近似换算：要衰减 X dB 所需时间 ≈ X /（Attack dB/s）。
      - 例：Attack=8000 dB/s，要衰减10 dB，仅需约1.25 ms（10/8000 s）。
    - 建议
      - 软限幅/音乐：2000–5000 dB/s（10 dB 衰减约2–5 ms），保留一定瞬态。
      - 保护型/电影：5000–10000 dB/s（<2 ms），快速抓峰，避免“啪”的失真。
  - Decay time（释放速度，dB/s）
    - 表示每秒最多“放回”多少分贝（从压缩状态恢复到正常增益）。
    - 数值越小=释放越慢；越大=释放越快。
    - 近似换算：恢复 X dB 需时 ≈ X /（Decay dB/s）。
      - 例：10 dB/s 恢复 10 dB ≈1 秒。
    - 建议
      - 0.5–2 秒恢复完 10 dB（即 5–20 dB/s）更自然，避免“喘息/泵音”。
  - Pregain（前级增益，dB）
    - 调整进入限幅器前的电平，相当于“让信号更早或更晚触发限制”。
    - 用法
      - 测量/校正时建议 0 dB（或关闭限制器），避免影响曲线。
      - 日常观看：从 0 dB 起步，逐步+1~+3 dB，听大动态场景（爆破/鼓点）是否偶尔被压住且不失真；过多会压扁动态与低频纹理。

### 六、Dynamic Bass Control（动态低频）

- 小音量听感补偿：在较小响度时自动增加低频能量；在大音量时减小或不加，避免过载。也可作为“节目动态驱动”的低频增强。

参数解释与使用

- Threshold（触发阈值，dB）
  - 信号电平低于该阈值时，开始按规则增加低频；高于阈值时，增强逐渐减弱或停止。
  - 设置思路
    - 小音量也想要饱满：阈值设得更低（如 −20 ~ −18 dB）。
    - 只在很安静时才补：设高一点（如 −15 ~ −12 dB）。
- Time constant（时间常数）
  - 控制增强的响应速度与平滑度。数值越小=跟随更快，越大=更平滑、慢一些（单位在不同版本可能是相对刻度或毫秒量级）。
  - 建议
    - 80–200 的中等范围（若是毫秒则 80–200 ms）通常既不过分“喘”，也不会反应迟缓。
    - 过小会有“泵感/呼吸”，过大则显得拖沓。
- Boost（最大增强量，dB）
  - 在触发条件满足时可给予的低频提升上限。
  - 建议
    - 初始 3–6 dB；小口径或行程有限的低音炮勿超过 6–8 dB。
    - 同时确保有足够的头room（整体音量或子通道先降 3–6 dB），避免一触即顶。
- Frequency（作用频率，Hz）
  - 增强的中心/上限频率（具体曲线随实现可能是低货架/带通增强）。频率越低，越偏向“超低”。
  - 建议
    - 密封箱：35–45 Hz，营造深潜；
    - 倒相箱：45–60 Hz，避开端口风噪与过行程；
    - 若系统下潜有限，宁可把 Frequency 稍高一些，也不要在 25–30 Hz 大量 Boost。

### 七、Preset Control（预设管理）

- Preset list：查看/切换已保存的整套设置（包含手动块 + 房间校正块）。
- Save：把当前整套参数保存为一个预设（建议场景化命名：Music/Film、Night 等）。

### 八、Options 

- Name

  - 作用：重命名这台设备的蓝牙广播名称，便于多台设备区分。
  - 提示：改名不影响内部参数或预设。

- UUID

  - 作用：设备的唯一识别码，只读，用于 App 识别与配对管理。

- Restore factory Settings

  - 作用：恢复出厂设置。会把 DSP 内的滤波（PEQ/FIR）、增益、分频、相位、动态/限幅等全部还原为工厂默认。
  - 用法：执行前建议先到 Preset 里保存当前配置，避免丢失。
  - 提示：通常不改变设备名称和配对码（视固件而定）。

- Change Pairing Code

  - 作用：修改设备的配对/解锁码（部分硬件用来限制谁能改参数）。
  - 用法：输入新码并确认；忘记配对码可能需要复位设备。
  - 提示：与手机系统蓝牙 PIN 不一定相同，这是设备层面的“管理口令”。

- HW Controllers

  面向硬件的“物理旋钮映射”功能。把硬件的旋钮情况映射到设置的范围。

  - Sync：与设备当前物理旋钮状态同步，把当前映射写入设备，具体取决于固件；习惯做法是调完范围→点 Sync→返回保存。
  - 圆圈“i”：帮助/说明入口。

  每个条目

  - Phase（开关 + Range）
    - 作用：让某个物理旋钮控制“相位全通过滤器（APF）的中心频率”，从而在分频点附近旋转相位做细调。
    - Range：限制旋钮对应的可调频率范围（例：63–340 Hz）。
    - 建议：把范围覆盖 LPF 分频点（如 60–120 Hz），便于对齐主箱；开启后，旋钮转动即可现场找“分频处最平顺/能量最大的相位点”。
  - HP Filter（开关 + Range）
    - 作用：把物理旋钮映射为次声高通（HPF）的截止频率。
    - Range：例 20–41 Hz；适合不同片源/声压下快速加大保护。
    - 建议：倒相箱把下限设在接近箱体 Fb，密封箱 18–25 Hz 为起点；影院大动态时可顺手提高一点保护。
  - LP Filter（开关 + Range）
    - 作用：把物理旋钮映射为低通（LPF）的截止频率。
    - Range：例 50–250 Hz；用于与主箱/AVR 的分频快速协同。
    - 建议：若 AVR 已做分频，避免双重管理；可把 iWoofer LPF 固定或只用于独立两声道系统。
  - Boost（开关 + Range）
    - 作用：把物理旋钮映射为低频增强量（通常是低货架/带通增益）。
    - Range：例 0–12 dB。
    - 建议：日常不超过 +3~+6 dB；与 SHS/Dynamic Bass 同时用时要留余量，观察 THD。

  使用步骤示例

  1. 打开相应开关；进入 Range 限定可调区间。
  2. 点右上 Sync 同步映射到设备。
  3. 返回上级页“Save”整体保存为预设。
  4. 现场使用时直接拧物理旋钮即可在限定范围内调参。

- Auto On/Off

  - 作用：信号感应自动开机/待机的设置入口。

    - Sync：与设备同步当前阈值/保持时间，或把滑块值写入设备（依固件行为）。一般做法是调好→点 Sync→返回保存。

    选项

    - Threshold（触发门限，单位 mVRMS）
      - 作用：输入信号（线电平）超过该有效值时，自动唤醒/开机。
      - 建议：
        - 大多数 AVR/播放器：5–20 mVRMS 起步；若设备无噪声但老是误唤醒，增大一点；
        - 若始终唤不醒，适当降低门限并确认信号线连接与输入源电平。
      - 提示：门限过低会被地噪/电磁干扰触发；过高会漏掉很小音量的使用场景。
    - Hold on time（保持开启时间）
      - 作用：当输入信号低于门限后，仍保持开机的时间，避免频繁启停。
      - 建议：2–10 分钟常见；夜听/短剧可以短一些，电影/串流可长一些，避免“喘气式”开关机。



# 蓝牙模块

## 蓝牙数据管理以及作用



![1](C:\Users\张彭威\Desktop\information_for_iwoofer\蓝牙模块\1.png)

# 抓包分析蓝牙数据

## ATT Receive：Handle Value Notification数据包

### 由开发者决定的

- 选用哪个特征 UUID 发送通知（这里是 FFF2）以及它的 attribute handle（这里是 0x0028）。
- 什么时候发通知（触发条件、频率）：例如 FIR 下载时定期上报进度，或测量时上报电平/THD。
- Value 字节串的结构、字段顺序、数值类型与端序。
  - 比如：是否是 3 个 uint16 小端？是否是 float32？是否包含状态位/错误码/序号等？
